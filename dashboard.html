<!DOCTYPE html>
<html>
<head>
    <title>NIFTY 50 Alpha Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

    <h1>üìä Model Outlook</h1>

    <div class="card">
        <p>
            Select a stock below to see its expected
            performance ranking for this month based on
            our cross-sectional alpha model.
        </p>
    </div>

    <!-- Prediction Section -->
    <div class="card center">
        <h2>üîç Check Stock Outlook</h2>

        <select id="stockSelect">
            <option value="INFY.NS">INFY</option>
            <option value="RELIANCE.NS">RELIANCE</option>
            <option value="HDFCBANK.NS">HDFCBANK</option>
            <option value="TCS.NS">TCS</option>
            <option value="ICICIBANK.NS">ICICIBANK</option>
            <option value="SBIN.NS">SBIN</option>
            <option value="LT.NS">LT</option>
            <option value="ITC.NS">ITC</option>
            <option value="BHARTIARTL.NS">BHARTIARTL</option>
            <option value="ASIANPAINT.NS">ASIANPAINT</option>
        </select>

        <br><br>

        <button class="primary-btn" onclick="predictStock()">
            Predict Performance
        </button>

        <div id="resultBox" style="margin-top:20px;"></div>
    </div>

    <div class="card">
        <h2>Strategy Notes</h2>
        <ul>
            <li>Cross-sectional ranking model</li>
            <li>Risk-normalized signals</li>
            <li>Transaction costs included</li>
            <li>20-day alpha horizon</li>
        </ul>
    </div>

    <div class="card center">
        <h2>üí¨ Suggestions</h2>
        <p>We welcome your feedback.</p>

        <a href="https://forms.gle/hML7UWuNUwxEWpdJA" target="_blank">
            <button class="primary-btn">Submit Suggestion</button>
        </a>
    </div>

</div>

<!-- JavaScript -->
<script>
async function predictStock() {

    const ticker = document.getElementById("stockSelect").value;

    document.getElementById("resultBox").innerHTML =
        "<p>Loading latest ranking data...</p>";

    try {
        const response = await fetch("https://nifty50-alpha-engine.onrender.com/rank");
        const data = await response.json();

        if (data.status !== "success") {
            document.getElementById("resultBox").innerHTML =
                "<p>Unable to fetch ranking data.</p>";
            return;
        }

        const stock = data.ranking.find(s => s.ticker === ticker);

        if (!stock) {
            document.getElementById("resultBox").innerHTML =
                "<p>Stock not found in ranking.</p>";
            return;
        }

        const probability = stock.percentile / 100;

        let riskLevel = "Moderate";
        if (stock.percentile >= 70) riskLevel = "Low";
        if (stock.percentile <= 40) riskLevel = "Elevated";

        document.getElementById("resultBox").innerHTML = `
            <div class="card">
                <h3>${stock.ticker}</h3>
                <p><strong>Rank:</strong> ${stock.rank} / ${data.total_stocks}</p>
                <p><strong>Percentile Rank:</strong> ${stock.percentile}%</p>
                <p><strong>Probability of Outperformance:</strong> ${(probability * 100).toFixed(1)}%</p>
                <p><strong>Risk Level:</strong> ${riskLevel}</p>
                <p style="margin-top:10px; font-size: 0.9em; color: gray;">
                    Last Updated: ${data.last_updated}
                </p>
            </div>
        `;

    } catch (error) {
        document.getElementById("resultBox").innerHTML =
            "<p>Error connecting to backend. Try again in a few seconds.</p>";
    }
}
</script>

</body>
</html>
